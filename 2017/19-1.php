<?php

$input = '                                                                                                                                       |                                                                 
     +---------------+       +-------+ +-----------------------------------------------------------------------------------------+     |                                               +-----+ +-+       
     |               |       |       | |                                                                                         |     |                                               |     | | |       
     | +-+ +-----------------|-------+ |           +-+         +-----------+ +---------------------------------------------------------|-----------------------------------------------------+ | |       
     | | | |         |       |         |           | |         |           | |                                                   |     |                                               |       | |       
   +-+ +---------------------|---------------------------------------------|-+         +---------------------------+             |     |       +-------+                   +-+     +-----------|-+       
   |     | |         |       |         |           | |         |           |           |                           |             |     |       |       |                   | |     |   |       |         
   |   +---|---+   +-|-------|---------|-----------|-----------+           |           |                           |     +-------|-------------|-------|-------------------|-|-------+ |       |         
   |   | | |   |   | |       |         |           | |                     |           |                           |     |       |     |       |       |                   | |     | | |       |         
 +-----|---|---|---|-|-------|---------+           +-----+                 |       +-------+ +---------------------------|-------|-------------|-----------------------------------+ | |       |         
 | |   | | |   |   | |       |                       |   |                 |       |   |   | |                     |     |       |     |       |       |                   | |       | |       |         
 | |   | | |   | +-|-------+ |         +-----------------|-------------+   |       +---|-----|---------------------|-------------|---------------------|---------------+   | |       | |       |         
 | |   | | |   | | | |     | |         |             |   |             |   |           |   | |                     |     |       |     |       |       |               |   | |       | |       |         
 +---+ | | |   +-----|-------|---------------------------------------------------------|---|-----------+     +-------------------|---+ |       |       |               |   | |       | |       |         
   | | | | |     | | |     | |         |             |   |             |   |           |   | |         |     |     |     |       |   | |       |       |               |   | |       | |       |         
   | | | +-|-+   +-------+ +-+         |             |   |             |   |           |   | |         |     |     |     |   +---|---+ |       |       |               |   | |       | |       |         
   | | |   | |     | |   |             |             |   |             |   |           |   | |         |     |     |     |   |   |     |       |       |               |   | |       | |       |         
   +---|-+ | |   +---|---|---------------------------|---|-----------------|---------------------------|-----|-----|---------|---|-----|---------------|-------------+ |   +-|-----+ | | +-----|---+     
     | | | | |   | | |   |             |             |   |             |   |           |   | |         |     |     |     |   |   |     |       |       |             | |     |     | | | |     |   |     
     | | | | |   | | |   |             |             |   |             |   |           |   | |         |     +-----|----I|---|---|-----------------+   +-------------|-----+ | +-+ | | | |     |   |     
     | | | | |   | | |   |             |             |   |             |   |           |   | |         |           |     |   |   |     |       |   |                 | |   | | | | | | | |     |   |     
     | | | | |   | | +---|------------------------B--|---|-------------|---------------|-----|---------|-----------|-------------------|-------|---|-----------------|-----|-----|-----|---------+ |     
     | | | | |   | |     |             |             |   |             |   |           |   | |         |           |     |   |   |     |       |   |                 | |   | | | | | | | |     | | |     
 +-+ | | | | |   | |     |             |       +-----|---|-------------|---------------|---|-|---------------------|---------+   |   +---------|---|-----+           | |   | | | | | | | |     | | |     
 | | | | | | |   | |     |             |       |     |   |             |   |           |   | |         |           |     |       |   | |       |   |     |           | |   | | | | | | | |     | | |     
 | | | | | | |   | |     |   +-+       |       | +-------|-----------------|-------------+ | |         |           |     |       |   | |       |   |     |           | |   | | | | | | | |     | | +-+   
 | | | | | | |   | |     |   | |       |       | |   |   |             |   |           | | | |         |           |     |       |   | |       |   |     |           | |   | | | | | | | |     | |   |   
 | | | | | | +---|-------|---|-|-------|---------|---|---|---------------------------------|-|---------------------|---+ |       |   | |       |   |     |           | |   | | | | | | | |     | |   |   
 | | | | | |     | |     |   | |       |       | |   |   |             |   |           | | | |         |           |   | |       |   | |       |   |     |           | |   | | | | | | | |     | |   |   
 | | | | | |     | |     |   | |       |   +---+ |   |   |             |   |       +---|-|-|-|---------|-----------|---|-------------|-|-------|---|-----------------|-------------------------|---+ |   
 | | | | | |     | |     |   | |       |   |     |   |   |             |   |       |   | | | |         |           |   | |       |   | |       |   |     |           | |   | | | | | | | |     | | | |   
 | | | | +-|-----------+ |   | |       |   +-----|---|---|-----------------|-----------|---|-----------------------|---|---------|-+ | |       |   |     |           | |   | +---|-|-|---|-+   | | | |   
 | | | |   |     | |   | |   | |       |         |   |   |             |   |       |   | | | |         |           |   | |       | | | |       |   |     |           | |   |   | | | | | | |   | | | |   
 | | | |   |     | |   | |   | |       |         |   |   +-------------------------|---|---------------|-----------+   | |       | | | |       |   |     |         +-|-|-------|-+ | | | | |   | | | |   
 | | | |   |     | |   | |   | |       |         |   |                 |   |       |   | | | |         |               | |       | | | |       |   |     |         | | |   |   |   | | | | |   | | | |   
 | | | |   |     | +-----|---|-------------------|---------+           |   |       |   | | | |         |               | |       | | | |       |   |     |         | | |   |   |   | | | | |   | | | |   
 | | | |   |     |     | |   | |       |         |   |     |           |   |       |   | | | |         |               | |       | | | |       |   |     |         | | |   |   |   | | | | |   | | | |   
 | | | |   |     |     | |   | |       |         |   |     |           |   |       |   | | | |         |               | |       | | | |       |   |     |         | | |   | +-------|-----|---|-|-----+ 
 | | | |   |     |     | |   | |       |         |   |     |           |   |       |   | | | |         |               | |       | | | |       |   |     |         | | |   | | |   | | | | |   | | | | | 
 | | | |   |     |     | +-------------|-------------|-----------------|---|-------|-------------------|---------------|---------------------------|-----------+   | | |   | +-+ +-|---|---|-----|---|-+ 
 | | | |   |     |     |     | |       |         |   |     |           |   |       |   | | | |         |               | |       | | | |       |   |     |     |   | | |   |     | | | | | |   | | | |   
 | | | |   |   +-----------------------------+   |   |     |   +---------------+   |   | | | |         |               | |       | | | |       |   |     |     |   | | |   |     | | | | | |   | | | |   
 | | | |   |   | |     |     | |       |     |   |   |     |   |       |   |   |   |   | | | |         |               | |       | | | |       |   |     |     |   | | |   |     | | | | | |   | | | |   
 +-|---|-------|-|-+   +-+   | +-------------|---|---|-----|---|-----------|-------|-------|-|-----------------------------------|---|-|-------|---|-----|---------|-|-|---|-----|---+ | | | +-|---|---+ 
   | | |   |   | | |     |   |         |     |   |   |     |   |       |   |   |   |   | | | |         |               | |       | | | |       |   |     |     |   | | |   |     | |   | | | | | | | | | 
 +-|---|-------------+   | +-|---------+   +-+   |   |     |   |       |   |   |   |   | | | |         |               | |       | | | |       |   |     |     |   | | | +---+ +-------|-|-|---|-|---|-+ 
 | | | |   |   | | | |   | | |             |     |   |     |   |       |   |   |   |   | | | |         |               | |       | | | |       |   |     |     |   | | | | | | | | |   | | | | | | | |   
 +---------|---|---|-|-----+ |             |     |   |     |   |       |   |   |   |   | | | |         | +---------------------+ | | | |       |   |     |     |   | | | | | | | | |   | | | | | | | |   
   | | |   |   | | | |   |   |             |     |   |     |   |       |   |   |   |   | | | |         | |             | |     | | | | |       |   |     |     |   | | | | | | | | |   | | | | | | | |   
   +-|-|-----------------|-----------------+ +---|---------|---+       |   |   |   |   +---|-----------|-|-------------|-------+ | | | |       |   |     |     |   +---|-|-|-|-+ | |   | | | | | | | |   
     | |   |   | | | |   |   |               |   |   |     |           |   |   |   |     | | |         | |             | |       | | | |       |   |     |     |     | | | | |   | |   | | | | | | | |   
     | |   |   | | | |   |   |               | +-|-------------------------|-------------|-|-+         | +---------------------------|-------------|-----------|-----|-|-|-|---+ | |   | | | | | | | |   
     | |   |   | | | |   |   |               | | |   |     |           |   |   |   |     | |           |               | |       | | | |       |   |     |     |     | | | | | | | |   | | | | | | | |   
     | |   | +-|-|-------|-----------------------+   |     |   +-+     |   |   |   |     | |           |       +---------|-------|-|-|-|-----------------------|---+ | | | | | | | |   | | | | | | | |   
     | |   | | | | | |   |   |               | |     |     |   | |     |   |   |   |     | |           |       |       | |       | | | |       |   |     |     |   | | | | | | | | |   | | | | | | | |   
 +-+ | |   | | | | | | +-+   |             +-|-------------|---|-|-----|---|---|-----------|---------------------------|---------|-|-|---------|---------|-----+   | | | | | | | | |   | | | | | | | |   
 | | | |   | | | | | | |     |             | | |     |     |   | |     |   |   |   |     | |           |       |       | |       | | | |       |   |     |         | | | | | | | | |   | | | | | | | |   
 | | | | +-----|-------|-------------------|-|-------|---------|-------|-----------|-----|-------------|---------------|-|---+ +---|---|-------|---|-----|---------|-|-----------------|-|---+ | | | |   
 | | | | | | | | | | | |     |             | | |     |     |   | |     |   |   |   |     | |           |       |       | |   | | | | | |       |   |     |         | | | | | | | | |   | | |   | | | |   
 | | | | | | | | | | | |     |             | | |     |     |   | |     |   |   |   | +-----|-----------|-------|-------------|-|-----|-------------|-----|-----------|-|---|-|-+ | |   | | |   | | | |   
 | | | | | | | | | | | |     |             | | |     |     |   | |     |   |   |   | |   | |           |       |       | |   | | | | | |       |   |     |         | | | | | |   | |   | | |   | | | |   
 | | | | | | | | | | | |     |             | | |     |     |   | |     |   |   |   | |   | |           |       |       | |   | +-------|-------|---------|---------|-|-------------|---|---+   | | | |   
 | | | | | | | | | | | |     |             | | |     |     |   | |     |   |   |   | |   | |           |       |       | |   |   | | | |       |   |     |         | | | | | |   | |   | |     | | | |   
 | | | | | | | | | | | |     |             | | |     |     |   | |     |   |   |   | |   | |           |       |       | |   |   | | | |       |   |     |         | | | | | |   +-|-------+   | | | |   
 | | | | | | | | | | | |     |             | | |     |     |   | |     |   |   |   | |   | |           |       |       | |   |   | | | |       |   |     |         | | | | | |     |   | | |   | | | |   
 | | | | | | | | | | | |     |             | | |     |     |   | |     |   |   |   | |   | |           |       |       | |   |   | | | |       |   |     +---------+ | | | | |     +---|-|-|---|-+ | |   
 | | | | | | | | | | | |     |             | | |     |     |   | |     |   |   |   | |   | |           |       |       | |   |   | | | |       |   |                 | | | | |         | | |   |   | |   
 | | | | | | | | | | | |     |             | | |     |     |   | |     |   |   |   | |   | |           |       |       | |   |   | | | |       |   |   +---------------|---|-----------|-|-|-------|-|-+ 
 | | | | | | | | | | | |     |             | | |     |     |   | |     |   |   |   | |   | |           |       |       | |   |   | | | |       |   |   |             | | | | |         | | |   |   | | | 
 | | | | | | | | | | | |     |       +-----|-|-------------|---|-|-----|-------------------|---------------------------|-|---|---|-|-------------------|-------------|-----|-|---------+ | +-----+ | | | 
 | | | | | | | | | | | |     |       |     | | |     |     |   | |     |   |   |   | |   | |           |       |       | |   |   | | | |       |   |   |             | | | | |           |     | | | | | 
 | | | | | | | | | | | |     |       |     | | |     |     |   | |     |   |   |   +-|-----|-----------|-------|-------+ |   |   | | | |       |   |   |             | | | | |     +-----|-+   | | | | | 
 | | | | | | | | | | | |     |       |     | | |     |     |   | |     |   |   |     |   | |           |       |         |   |   | | | |       |   |   |             | | | | |     |     | |   | | | | | 
 | | | | | | | | | | | |     |       |     | | |     |     |   | |     |   |   |     |   | |           +-------|-----------------|-|---|---------------|-----------+ | | | | |     | +---|-|-----+ | | | 
 | | | | | | | | | | | |     |       |     | | |     |     |   | |     |   |   |     |   | |                   |         |   |   | | | |       |   |   |           | | | | | |     | |   | |   |   | | | 
 | | | | | | | | | | | |     |       +-----|-|-------|-----|-----|-----|---|---|-----|--K--|-------------------|---------|---------|-|-----------------|-----------|-------+ | +-----+   | |   |   | | | 
 | | | | | | | | | | | |     |             | | |     |     |   | |     |   |   |     |   | |                   |         |   |   | | | |       |   |   |           | | | |   | |   |     | |   |   | | | 
 | | | | | | | | | | | |     |             | | |     |     |   | |     |   |   |     |   | |                   |         |   |   | | | |       |   |   |           | | | |   | |   |     | |   |   | | | 
 | | | | | | | | | | | |     |             | | |     |     |   | |     |   |   |     |   | |                   |         |   |   | | | |       |   |   |           | | | |   | |   |     | |   |   | | | 
 | | | | | | | | | | | +-----|---------------|-------|-----|---|-------|---------------------------------------|---------|---+   | | | |       |   |   |       +---+ | | |   | | +-|-----|---+ |   | | | 
 | | | | | | | | | | |       |             | | |     |     |   | |     |   |   |     |   | |                   |         |       | | | |       |   |   |       |     | | |   | | | |     | | | |   | | | 
 | | | | | | | +---|-----------------------|-|-------|-----|---+ |     |   |   |     |   | |                   |         |       | | | |       |   |   | +-------------------|-|---|---+ +-|-|-+   | | | 
 | | | | | | |   | | |       |             | | |     |     |     |     |   |   |     |   | |                   |         |       | | | |       |   |   | |     |     | | |   | | | |   |   | |     | | | 
 | | | | | | | +-|-|-+       |             +---+     |     |   +---------------|---------|---------------------|-----------------|-|-|-----------+ |   | |     |   +-|-|-|-------|---+ |   | |     | | | 
 | | | | | | | | | |         |               |       |     |   | |     |   |   |     |   | |                   |         |       | | | |       | | |   | |     |   | | | |   | | | | | |   | |     | | | 
 | | | | | | | | | |         |               |       |     |   | |     |   |   |     |   | |                   |       +-|---------|-|---------|---------------|---|-|-|-|-------|-|-|-----|-|-----|-+ | 
 | | | | | | | | | |         |               |       |     |   | |     |   |   |     |   | |                   |       | |       | | | |       | | |   | |     |   | | | |   | | | | | |   | |     |   | 
 | | | | | | | | | |         |               |       |     |   | |   +---------|-----|---|-+                   |       | |       | | | |       | | |   | |     |   | | | | +---|-----------|-------|-+ | 
 | | | | | | | | | |         |               |       |     |   | |   | |   |   |     |   |                     |       | |       | | | |       | | |   | |     |   | | | | | | | | | | |   | |     | | | 
 | | | | | | | | | |         |               | +-----|-----------------|---|-------------|---------------------|-----------------|-|-|-|---------|-|-----|-----|-+ +-----|---+ | | | | |   | |     | | | 
 | | | | | | | | | |         |               | |     |     |   | |   | |   |   |     |   |                     |       | |       | | | |       | | |   | |     | |   | | | |   | | | | |   | |     | | | 
 | | | | | | | +---+         |               +-|-----+     +---|-|-----|---|---|-----|-------------------------------------------|---------------|-|-----|-----|-----|-|-|---+ | | | | |   | |     | | | 
 | | | | | | |   |           |                 |               | |   | |   |   |     |   |                     |       | |       | | | |       | | |   | |     | |   | | | | | | | | | |   | |     | | | 
 | | | | | | |   | +---------|-----------------+               | |   | |   |   |     |   |     +---------------|-----------------|---|-|-------|-|-|---|-|---------+ | | | | | | | | | |   | |     | | | 
 | | | | | | |   | |         |                                 | |   | |   |   |     |   |     |               |       | |       | | | |       | | |   | |     | | | | | | | | | | | | |   | |     | | | 
 | | | | | | |   | | +-------|---------------------------------------------|---------|---|-----|-----------------------|---------+ | | |       | | |   | |     | | | | +-----|-|-+ | | |   | |     | | | 
 | | | | | | |   | | |       |                                 | |   | |   |   |     |   |     |               |       | |         | | |       | | |   | |     | | | |   | | | |   | | |   | |     | | | 
 | | | | | | | +-+ | |       |                                 | |   | |   |   |     |   |     |               |       | |         | | |       | | |   | |     | +---|-----|---|---|-------------+ | | | 
 | | | | | | | |   | |       |                                 | |   | |   |   |     |   |     |               |       | |         | | |       | | |   | |     |   | |   | | | |   | | |   | |   | | | | 
 | | | | | | | | +-----------|-------------------------------+ | |   | |   |   |     |   |     |               |       | |         | | |       | | |   | |     |   | | +-|-+ | | +-----|---------|-+ | | 
 | | | | | | | | | | |       |                               | | |   | |   |   |     |   |     |               |       | |         | | |       | | |   | |     |   | | | |   | | | | | |   | |   |   | | 
 | | | | | | | | | +---------|-------------------------------------------------------|---|-----|-----------------------------------|-|-----------------|-----+ |   | | +-----|-+ | | | |   | |   |   | | 
 | | | | | | | | |   |       |                               | | |   | |   |   |     |   |     |               |       | |         | | |       | | |   | |   | |   | |   |   |   | | | |   | |   |   | | 
 | | | | | +---|-|-------------------+               +-----------------|-------------|---|-+   |               |       +-|---------|---|---------------|-|-----|---|-|-+ | L | +-|---|-|---|-|---|---+ | 
 | | | | |   | | |   |       |       |               |       | | |   | |   |   |     |   | |   |               |         |         | | |       | | |   | |   | |   | | | | | | | | | | |   | |   |     | 
 | | | | |   | | |   |       |       |               |       | | |   | | +-+   |     |   | |   |               |         |         | | |       | | |   | |   | |   | | | | | | | | | | |   | |   |     | 
 | | | | |   | | |   |       |       |               |       | | |   | | |     |     |   | |   |               |         |         | | |       | | |   | |   | |   | | | | | | | | | | |   | |   |     O 
 | | | | |   | | |   |       |       |               |       +---+   | | +-----------|---------+               |         |         | | |       | | |   +-|-+ | |   | | | | | | | +---|-+   | |   |     | 
 | | | | |   | | |   |       |       |               |         |     | |       |     |   | |                   |         |         | | |       | | |     | | | |   | | | | | | |   | |     | |   |     | 
 | | | | | +-----+ +-|-------|-------|-------------------------------|---------|-----|-----|-------+           |         |         | | |       | | |     +-----|-------------|-|---|-----+ | |   | +---+ 
 | | | | | | | |   | |       |       |               |         |     | |       |     |   | |       |           |         |         | | |       | | |       | | |   | | | | | | |   | |   | | |   | |     
 | | | | | | | |   | |       |       |               |         |     | |       |     |   | |       |           |         |         | | |       | | |       | | |   | | | | | | |   | |   | | |   | |     
 | | | | | | | |   | |       |       |               |         |     | |       |     |   | |       |           |         |         | | |       | | |       | | |   | | | | | | |   | |   | | |   | |     
 | | | | | +---|----N------+ |       |               |         |     | |       |     |   | |       |           |         +-----------------------------+   | | |   | +-|-----|-|---|-+   | | |   | |     
 | | | | |   | |   | |     | |       |               |         |     | |       |     |   | |       |           |                   | | |       | | |   |   | | M   |   | | | | |   |     | | |   | |     
 | | | | |   | |   | |     | |       |               | +---------------|-------------------|-------|---------------------------------------------|-+   |   | | |   |   | | | | |   |     | | |   | |     
 | | | | |   | |   | |     | |       |               | |       |     | |       |     |   | |       |           |                   | | |       | |     |   | | |   |   | | | | |   |     | | |   | |     
 | | | | |   | +---|-|-------|-----------------------|-|-------|-------------------------|---------------------|-------------------|-|-|-+     | |     |   | | |   |   | | +-|-+   |     | | |   | |     
 | | | | |   |     | |     | |       |               | |       |     | |       |     |   | |       |           |                   | | | |     | |     |   | | |   |   | |   |     |     | | |   | |     
 | | | | |   |     | |     | |       |               | +-------|-------|-+     |     |   | |       |           |                   | | | |     | |     |   | | |   |   | |   |     |     | | |   | |     
 | | | | |   |     | |     | |       |               |         |     | | |     |     |   | |       |           |                   | | | |     | |     |   | | |   |   | |   |     |     | | |   | |     
 | | | | |   | +---|-|-----|-|-------|---------+     |       +---+   +---------|-----------|-------|-----------|-------------------------|-------+     |   | | |   |   | |   |     |     | | |   | |     
 | | | | |   | |   | |     | |       |         |     |       | | |     | |     |     |   | |       |           |                   | | | |     |       |   | | |   |   | |   |     |     | | |   | |     
 | | +-------------|---------|-----------------------|---------|-|-------------|-----|---|---------|-----------|-------------------|-|-+ |     |       |   | | |   |   | |   |     |     | | |   | | +-+ 
 | |   | |   | |   | |     | |       |         |     |       | | |     | |     |     |   | |       |           |                   | |   |     |       |   | | |   |   | |   |     |     | | |   | | | | 
 | |   | |   | |   | |     | |       |         |     |       | | |     | |     |     |   | |       |           |                   | |   |     |       |   | | |   |   | |   |     |     | | |   | | | | 
 | |   | |   | |   | |     | |       |         |     |       | | |     | |     |     |   | |       |           |                   | |   |     |       |   | | |   |   | |   |     |     | | |   | | | | 
 | |   | |   | |   | |     +-------------------|-----|-----------|-----|-|-----|-----------|---------------------------------------|-+   |     |       |   | +-|---|-----|-+ |     +-------|---+ | | | | 
 | |   | |   | |   | |       |       |         |     |       | | |     | |     |     |   | |       |           |                   |     |     |       |   |   |   |   | | | |           | | | | | | | | 
 | |   | |   | |   | |     +-|-------|---------------------------|-----|---------------+ | |       |           |                   |     |     |       |   |   |   |   | | | |           | | | | | | | | 
 | |   | |   | |   | |     | |       |         |     |       | | |     | |     |     | | | |       |           |                   |     |     |       |   |   |   |   | | | |           | | | | | | | | 
 | |   | |   | |   | |     | |       +-----------------------------------|-----------|---------------------------------------------|-----|-------------|-----------------|-|---+         | | | | | | | | 
 | |   | |   | |   | |     | |                 |     |       | | |     | |     |     | | | |       |           |                   |     |     |       |   |   |   |   | | | | |         | | | | | | | | 
 | |   | |   | |   | |     | |                 |     |     +-|-|---------|---------------|-|---------------------------------------|-----------|-------|---|-+ |   |   | | | | |         | | | | | | | | 
 | |   | |   | |   | |     | |                 |     |     | | | |     | |     |     | | | |       |           |                   |     |     |       |   | | |   |   | | | | |         | | | | | | | | 
 | |   | |   | |   | |     | |                 |   +-|-----|-+ | |     | |     |     | | | |       |           |                   |     |     |       |   | | |   |   | | | | |         | | | | | | | | 
 | |   | |   | |   | |     | |                 |   | |     |   | |     | |     |     | | | |       |           |                   |     |     |       |   | | |   |   | | | | |         | | | | | | | | 
 | |   | |   | +---|-|-----------------------------|-|---------|-------|-|-------------|-|-|-------------------|-------------------------|-----|-------|---|-|---------|-|-|-|-|---------|-+ | | | | | | 
 | |   | |   |     | |     | |                 |   | |     |   | |     | |     |     | | | |       |           |                   |     |     |       |   | | |   |   | | | | |         |   | | | | | | 
 | |   +-----|-------|-----|-------------------|-----|-----|-----------|-|-----|-------|-|-----------------------------------------|---------+ |       |   | | |   | +---|-|-----------+ |   | | | | | | 
 | |     |   |     | |     | |                 |   | |     |   | |     | |     |     | | | |       |           |                   |     |   | |       |   | | |   | | | | | | |       | |   | | | | | | 
 | |     |   |     | |     | |                 |   | |     | +-------+ | |     |     | | | |       |           |                   |     |   | |       |   | | |   | | | | | | |       | |   | | | | | | 
 | |     |   |     | |     | |                 |   | |     | | | |   | | |     |     | | | |       |           |                   |     |   | |       |   | | |   | | | | | | |       | |   | | | | | | 
 | | +-------|-+   | |     | |                 |   | |     +-|---|---|-+ |     |     | | | |       |           |                   |     |   | |       |   | | |   | | | | | | |       | | +---+ | | | | 
 | | |   |   | |   | |     | |                 |   | |       | | |   |   |     |     | | | |       |           |                   |     |   | |       |   | | |   | | | | | | |       | | | |   | | | | 
 | | |   |   | |   | |     | |                 |   | | +-------|---------------------|-|-------------------------------------------|-----|---|-|-----------|-|-|-----|-|-|-|---+       | | | |   | | | | 
 | | |   |   | |   | |     | |                 |   | | |     | | |   |   |     |     | | | |       |           |                   |     |   | |       |   | | |   | | | | | |         | | | |   | | | | 
 | | | +-----|-|-----|------------------------------X--|-----|-|-|-------------|-----|---|---------------------|-------+           |     |   | +-------|-----------|-|-----|---------+ | | | |   | | | | 
 | | | | |   | |   | |     | |                 |   | | |     | | |   |   |     |     | | | |       |           |       |           |     |   |         |   | | |   | | | | | |       | | | | |   | | | | 
 | | | | +-+ | |   | |     | |                 |   | | |     | | |   |   |     |     | | | |       |           |       |       +---------|---|---------|---|-------|-|-----------------|-|--H|-------+ | 
 | | | |   | | |   | |     | |                 |   | | |     | | |   |   |     |     | | | |       |           |       |       |   |     |   |         |   | | |   | | | | | |       | | | | |   | |   | 
 | | | |   | | |   | |   +---|---------------------|-|-------|---|-------|---------------|---------|-+         |       |       |   |     |   |         |   | | |   | | | | | |       | | | | |   | |   | 
 | | | |   | | |   | |   | | |                 |   | | |     | | |   |   |     |     | | | |       | |         |       |       |   |     |   |         |   | | |   | | | | | |       | | | | |   | |   | 
 | | | |   +---|---------|-+ |                 | +-----|-----|-------|---------|-----|-|-|---------------------+       |       |   |     |   |         |   | +-------------|-----------+ | | |   | |   | 
 | | | |     | |   | |   |   |                 | | | | |     | | |   |   |     |     | | | |       | |                 |       |   |     |   |         |   |   |   | | | | | |       |   | | |   | |   | 
 | | | |     | |   | |   |   |                 | | | | +-----+ | |   |   |     |     | | | |     +-|-+                 |       |   |     |   |         |   |   |   | +-|-|---------+ |   | | |   | |   | 
 | | | |     | |   | |   |   |                 | | | |         | |   |   |     |     | | | |     | |                   |       |   |     |   |         |   |   |   |   | | | |     | |   | | |   | |   | 
 | | | | +---|---+ | | +-|---|-------------------|-|-|---------|-----|---|---------+ | | | |     | |                   |       |   |     |   |         |   |   |   |   | | | |     | |   | | |   | |   | 
 | | | | |   | | | | | | |   |                 | | | |         | |   |   |     |   | | | | |     | |                   |       |   |     |   |         |   |   |   |   | | | |     | |   | | |   | |   | 
 | | | | +-----+ | | | +-----------------------------------------|-------|-----|-----|-|-|-|-----+ |                   +-----------|---------|-----------------|---|---|---|---+   +-|---------+ | |   | 
 | | | |     |   | | |   |   |                 | | | |         | |   |   |     |   | | | | |       |                           |   |     |   |         |   |   |   |   | | | | |     |   | | | | | |   | 
 | +---|---------|-|-------------------------------|-|---------|-----|---|-------------|---|-------|-------------------------------------|-------------|---|-+ |   |   | | | | |     |   | | | | | |   | 
 |   | |     |   | | |   |   |                 | | | |         | |   |   |     |   | | | | |       |                           |   |     |   |         |   | | |   |   | | | | |     |   | | | | | |   | 
 | +-|---+ +-|---|-+ |   +---|-------------------|-|-----------|-|-----+ |     |   | | | | |       |                           |   |     |   |         |   | | |   |   | | | | |     |   | | | | | |   | 
 | | | | | | |   |   |       |                 | | | |         | |   | | |     |   | | | | |       |                           |   |     |   |         |   | | |   |   | | | | |     |   | | | | | |   | 
 | | | | | | |   +---|-------------------------|-|-------------|-----|---------+   | | | | +-------|---------------------------|---|-----|---|---------|---|-|-----|---|-----|-------|---|-----+ | |   | 
 | | | | | | |       |       |                 | | | |         | |   | | |         | | | |         |                           |   |     |   |         |   | | |   |   | | | | |     |   | | |   | |   | 
 | | | +-------------|-------+                 | | +-|---------|-|---|-|-----------|-|-----------------+                       |   |     |   |         |   | | |   |   +---|-|-------|---|-|-|-+ | |   | 
 | | |   | | |       |                         | |   |         | |   | | |         | | | |         |   |                       |   |     |   |         |   | | |   |     | | | |     |   | | | | | |   | 
 | | |   | | |       |                         | |   +---------|-|-----|-|---------|---|-|-+       |   |                       |   |     |   |         |   | | | +-------|---|-------|-------|-|-|-|-+ | 
 | | |   | | |       |                         | |             | |   | | |         | | | | |       |   |                       |   |     |   |         |   | | | | |     | | | |     |   | | | | | | | | 
 | | |   +-|-----------------------------------|---------------------|-|-|---------|---|-|---------|---+                       |   |     |   |         |   | | | | |     | | | |     |   | | | | | | | | 
 | | |     | |       |                         | |             | |   | | |         | | | | |       |                           |   |     |   |         |   | | | | |     | | | |     |   | | | | | | | | 
 | | |     | |       |                         | |             | |   | +-------------|---|-------------------------------------|---------|---|---------|-+ | | | | |     | | | |     |   | | | +-|-|-|-+ 
 | | |     | |       |                         | |             | |   |   |         | | | | |       |                           |   |     |   |         | | | | | | |     | | | |     |   | | |   | | |   
 | | |     | |       +-----------------------------------------|-|-------------------|-------------|---------------------------|-----+   |   |         | +-|---|-|-----+ | | | +-----|---|-|---+ | | |   
 | | |     | |                                 | |             | |   |   |         | | | | |       |                           |   | |   |   |         |   | | | | |   | | | |       |   | | | | | | |   
 +-|-------|-----------------------------------|---------------------|-------------|-|-|---|-------+         +-----------------+   | |   |   |         |   | | | | |   | | | |       |   | | | | | | |   
   | |     | |                                 | |             | |   |   |         | | | | |                 |                     | |   |   |         |   | | | | |   | | | |       |   | | | | | | |   
   | |     +-|-----------------------------------|---------------|-----------------|---|---|-----------------|---------------------|-------------------+   | | | | |   | | | |       |   | | | | | | |   
   | |       |                                 | |             | |   |   |         | Z | | |                 |                     | |   |   |             | | | | |   | | | |       |   | | | | | | |   
 +-|-|-------+       +-------------------------|-----------------+   +---+         | | | | |                 |                     | +-----------------------|-+ | |   | | | |       |   | | | | | | |   
 | | |               |                         | |             |                   | | | | |                 |                     |     |   |             | |   | |   | | | |       |   | | | | | | |   
 +-----------+       +-+                       +-|-------+     +-------------------+ | +---+   +-----------------------------------------------------------|-|---|-|---|-|-|-|-+     |   | | | | | | |   
   | |       |         |                         |       |                           |   |     |             |                     |     |   |             | |   | |   | | | | |     |   | | | | | | |   
   +---------|---------|-------------------------+       +-------------+             |   |     +-------------|---------------------+     +---------------+ | |   | +---|-----|-----+ |   | +-|-|-+ | |   
     |       |         |                                               |             |   |                   |                               |           | | |   |     | | | | |   | |   |   | |   | |   
     |       +---------|-----------------------------------------------|---------------------------------------------------------------------------------|-|-----|-----|-|-+ | |   | |   |   | |   | |   
     |                 |                                               |             |   |                   |                               |           | | |   |     | |   | |   | |   |   | |   | |   
     +-----------------+ +-------------------------------------------------------------------------------------------------------------------+           | | +---|-----|-----|-----|-+   |   | |   | |   
                         |                                             |             |   |                   |                                           | |     |     | |   | |   |     |   | |   | |   
                         |                                             |             |   |                   |                                           | +-----|-----|-|-----|---|---------+ |   | |   
                         |                                             |             |   |                   |                                           |       |     | |   | |   |     |     |   | |   
                         +---------------------------------------------------------------|-------------------|-------------------------------------------|-------|-------|---------------+     |   | |   
                                                                       |             |   |                   |                                           |       |     | |   | |   |           |   | |   
 +---------------------------------------------------------------------|-------------|-----------------------+                                           |       +-------+   | |   |           +---|-+   
 |                                                                     |             |   |                                                               |             |     | |   |               |     
 |                                                                     +-------------+   |                                                               +-------------|-----+ |   +-----------+   |     
 |                                                                                       |                                                                             |       |               |   |     
 +---------------------------------------------------------------------------------------+                                                                             +-------+               +---+     
                                                                                                                                                                                                         ';
$test = '     |          
     |  +--+    
     A  |  C    Co
 F---|----E|--+ 
     |  |  |  D 
     +B-+  +--+ 
';
//$input = $test;

$rows = explode("\n", $input);
$grid = [];
foreach ($rows as $i => $row) {
    if (! isset($grid[$i])) {
        $grid[$i] = [];
    }
    foreach (str_split($row, 1) as $char) {
        $grid[$i][] = $char;
    }
}

$dirs = [
    'up' => new Coord(0, -1),
    'down' => new Coord(0, 1),
    'left' => new Coord(-1, 0),
    'right' => new Coord(1, 0),
];
$opposites = [
    'up' => 'down',
    'left' => 'right',
    'down' => 'up',
    'right' => 'left',
];
$expected = [
    'up' => '|',
    'left' => '-',
    'down' => '|',
    'right' => '-',
];

$pos = new Coord(array_search('|', $grid[0]), 0);
$dir = 'down';
$oldLetters = '';
$letters = '';

while (isset($grid[$pos->y][$pos->x])) {
    $char = $grid[$pos->y][$pos->x];
    echo $char . "\n";
    switch ($char) {
        case '|':
        case '-':
            break;
        default:
            if ($char !== '+') {
                $letters .= $char;
            }
            $newDirs = [];
            $newDirs[$dir] = $dirs[$dir];
            foreach ($dirs as $newDir => $coords) {
                if ($newDir !== $dir && $newDir !== $opposites[$dir]) {
                    $newDirs[$newDir] = $coords;
                }
            }
//            echo '(';
//            print_r(implode(', ', array_keys($newDirs)));
//            echo '): ';

            foreach ($newDirs as $newDir => $coords) {
                $newPos = $pos->add($coords);
                if (
                    isset($grid[$newPos->y][$newPos->x])
                    && (
                        $grid[$newPos->y][$newPos->x] !== ' '
                        || preg_match('/^[A-Z]$/', $grid[$newPos->y][$newPos->x])
                    )
                ) {
                    $dir = $newDir;
                    break 2;
                }
            }
            echo "HALTING:\n";
            print_r($dir);
            print_r($pos);
            break 2;
    }
//echo "$dir: ";
    $pos = $pos->add($dirs[$dir]);
    if ($letters != $oldLetters) {
        echo $letters . "\n";
        $oldLetters = $letters;
    }
}
echo "\n";
print_r($pos);
print_r($letters);
echo "\n";





class Coord
{
    public $x;
    public $y;

    public function __construct($x, $y)
    {
        $this->x = $x;
        $this->y = $y;
    }

    public function add(Coord $vector)
    {
        return new Coord($vector->x + $this->x, $vector->y + $this->y);
    }
}