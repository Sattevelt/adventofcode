<?php

$data = [
    '..#...##......#....#....##...#.##.....#..#.....##.#.#..#..#.......#.....#......#..#.###......###',
    '..#......##.#.##......#............##.....####..#.......#..#...#.......##............#.#..##.#..',
    '.....#.........#.#...#..##..............###......#..#...#.#.#.#.#......#.....#...#...........#..',
    '..#.....#...#....#.....##..#.#..#...#.#...#..#....#......#.#.#..##....##.....##.........#.....##',
    '........##...#.....#.#..##........#...#......#...#.....##.#..#......#...#.............##.###....',
    '#....#####....#...#..#..#.....#.#....#.###......#.......##...##.#..#..#.....#...#.##............',
    '....#........####.....#......#......##..#.##....###..#.....#...##....##......###..#....#.#.##...',
    '.##.###.#..#.....#....##.#......#..##..##.##...#....##...###..#.......#....#..###.#...#...#.....',
    '.#.#...##.........#..#.#.#.##....#.......#.#..##..#...###.......#..#...#.....##.........##...##.',
    '#....#.#.####..##....###...#..#.......##.......#...#..#.#..#......#.#.....#........#........#.##',
    '...##.####.....#..#.#...#........#....#...#...###.#....#.....##.#....#.##.#.....##...#..........',
    '......###..#.........#.....#.#.#.##....#.#...#....#.#..#####...#...##.##.#........#....#..#..##.',
    '..............##..##..#....#.....#....#...#...####........#...##...#.#..#..##.#......#.#.#...#..',
    '#....#...#......#.#.###.#...#.#.##........##.....##..#..#....##....#...#.#....##.#.#.......##...',
    '........#......#..#..#...#..##.....#.#...#..##.....#...........#...#.#..##...#.....#.#.#.....##.',
    '.#.##.#.##...#....##.....#.#................#.....#.........#.##...........#...#.......###.#...#',
    '#....#.#.#........#.#...#........##.....#.#.......#....#...####........#...#####..........##.#..',
    '.###....#....#.#.....#..##......#.....#..#....#.....##.....#..####.#.........###.#..##...#..#.#.',
    '##...#..#.#..#........#....#.#....###....##..##..........#.....##...#.#...#.##...#..##..#..###.#',
    '#....##.......##..#...##..#.#.......#.....###..........#..#...#.##...#..#.##.#.....##..##.....#.',
    '#.#.##..##....#.#...#.##..###..##.......#.#.#...#..............#.##.#.####.#.#..#..#.#..###.#...',
    '##...#...#..##...#.##..##.##....#..........#.#.........##...####..##.#.##......#.##.#.##.###....',
    '.#....#..###..#.#..#.#........#............#........#..##.#...#.#....#......#..##.##........#...',
    '...##....###...#.#..........#..#....#...#......#.#.......#.###.#.##...........#.#...#...##.##...',
    '..#...........##.#..#....#.#.#......#..#.##.....#.#..#.#.#.....##........#..........##...#.#....',
    '.#........#.#.....#.#.......##......#.....#..#...#......#....#.#.#..##...#.........##....##.#...',
    '............#.#..#...#.#....##...##..#.....##..#....#.#............#.................#..###..#.#',
    '........###............###..###.#....#..##....#####.#............#.....#.......#.#.#.#..#..#.#.#',
    '.........#..#........#....##.#..##..#...#..#..#..##.##...#....#.#...#....#......#.##......#.###.',
    '.........#.#.#.###.#....#....####......#...#.....##......#.#..#...##.....#####..#..#.....#..#..#',
    '.................##...###...#..#...##....#....#.###.............#.....#....#......#.##.#.#.###..',
    '.........#..#.......#..##...#.#..#....#...#......#.......#.#..#..#...###....#.#.#........###....',
    '........................#..###.#.#...###...#.##.........###...#...#.....##....#..##.#.#.......#.',
    '#.#............#.#........#........#....#.#..##.#..###......###....##...##.#.#..##......##.#..#.',
    '.#.#.#.#.#.#.#...####..#.........##.###...#....#.##....#...##...##....#.#.#....#.###........##..',
    '....#................##...#.#............#....#..####.##..#..#...........####....#..........##.#',
    '#.....#.#.........##...###....#...#...##...#....#...........####..#.######....##.........#.###..',
    '.....#...#.......#.#....##........##.#.#.....#..##....#....##.....###..#..###....##..#....#...#.',
    '.#...###...##...#..##..#.##....#..#........#.#..#.#.#...###.##.....##...#.#..#...#...##.##..#...',
    '...#......#.#.#.##......#...##...#...####....#..#..#...#.#.##.........#.#........##.............',
    '......##..#.....#...#............#..#.#.#........#......####.#...##...####................#..##.',
    '..##..###..##............#.................#.#...##..#....#.#....##.#.#.#...###.......#......#..',
    '...##..##...........#....#.#..#..#####..#...#...##......#....##.###.###..#.##.......###..#.....#',
    '.........#..............#.#.##.#......#..#.#.#.#.#.#...#...#.##.#..........#.#.##.......#.##....',
    '...#...........#....#.##.....###.#.#..............##....#..##..#.....#...#.##...#.#..#.##..##...',
    '.#.......#..##............#.#.........###..#.#..#..#.##.....##....#...................#......#.#',
    '....#.##...#...#..#..#....##........#..##.......#.....#.##.#...#....##..............#.#...#.#...',
    '....#.##........##.#..##...#.#.....#....##.#..##..#.#.......#.....#.......#..#.#....##..#....#..',
    '.###.....##....#....#.#.##.#.....#.#......#...#####.....#.#.##..#...#......###......##.#.......#',
    '..#..##...#.......##..#..##..##...#.#.#.......#...#.#....###....##....##.....##.##...#.#.##...#.',
    '#..#.#...#.......#.......#...#.##...#..........#.#...###.#..##......#.#....#.#.....#......#..#..',
    '#....#....#.#.##..........#..#.....#.#..........#....#.#.#..##.#.##..#........#......#..##......',
    '#.......#..#.######...#...#..#...#...#....##....#..#.##....##.#...#....#....#...#...#.#.#......#',
    '#....#......#.#....#..#....#.#.............##.##.#....###..#.#..##....#.....#..#...###..........',
    '..#.##..##...........#..#..###.........##....#.......#...#.....#.###.....##..........#..........',
    '..#...##.#.....##..#.#....#..........#.....#.#.#.......####...#.#...............#....#.....##..#',
    '...#....####...#..#......##.#..#....#..........#...........#.#.#...#.##.#.........#........#..#.',
    '.#..####..#..#...#..#...##.#....#..#....##......#...#.#...#.#...#...#.#.#...#..##......#..#.....',
    '#........#....#........#.##..#.####....#........##...................#...#.....#.##....##..##.##',
    '...#......#..#......#......###.##........#.##.##..#...#.#...##.##....##.....#..##...#..#...#....',
    '...#..........#.#.#.......####......#.#......#...##.....#.......#.#......#.......###..#..#..#.#.',
    '..#.#.#..#.....#.#...#.....###....#.......##......#..#...#..#..##.#.##.........#......##...#....',
    '..........##..#..##.......#....#.##.##.#.##.#..#..#.#.......#.##...#..#.......#.##..#.#.##..#.##',
    '....#.##..#..........#...#.#..#..#.##..#....#..####.#.......#.#...##.#..........##....##.......#',
    '....##.#.#.....#.#....#.#....#...#.#.##..##..##.#........##......#..###..##....#...#......#.....',
    '...###..#....##...#...##.#.##..#.......####....##........#.#...####..#........#..#..##..........',
    '.........###.###..#..#...#.##.#.#.#.#...#.......###..#.#.......##.#...#.....#..........#.#......',
    '..#......##....#.#..#...##..#.##.###.#.....##...#.#.#...##.##.#.#...###..#..#..#.#..#.......#...',
    '......#...#.#.###...#.#..#..#..##......###.#...#...#...#.#..#..##..#..###.......#..#...##...#.##',
    '#..###.#..#..#.#.#........#..##.##.###..#.##..###.##.....##..##..#...###..##.#..###....#....#...',
    '....#....#.......#..###......###...####..##...#.###.##....#.....##.........#...#..#...#..#...##.',
    '......#.#...#...#.#.......#.##.#..###......#...##....#.#.#.#...#........#.....#.##..#.##.#.#...#',
    '...#...#..##..#...##...#....#.....#........##..#..#..#..#.....#.##.#.##..##.........#......#....',
    '#..#.....#...#..##.#..###..##..........#....#..#....#.......#...##......#.#.#.###.#.#.#...#..##.',
    '..##.##.###..#..#....#.##...#..#........#..#.##....#.#...#...####...#.....#....##......#..#.....',
    '..#...###.##.........#.#..#..#.......................#.##.#.#....#.#......##....##.....#..##.#.#',
    '..#..##.#.#.###..#..#.##..#..#..#.#.#.......#.......##...##...####....#....#..#.##.#.##....#.#..',
    '...#...##...#.....#.....##..#.##.###..#.#..#.......#.#...#...........#..##.........#.#..#..#....',
    '##.......#..#.#...##...#..#...##.#......#...#........##..#..##...#..#...##.##.##......#..#......',
    '..............#.#.##.....#.....#.....#...####.###...#..#..........#...#...#..#......#.#.....#...',
    '##...#....#...#...#.#....#..#...#..#.#.#...#.#......##.#.##.##.......##......#.#...#...#..#..##.',
    '.#......#.......#..#..#......#.#.....#.#.#.....##.###.....#.......#.......#..#.#...#...##.......',
    '.###.###...#..#...........#..##..........#....##....#..##.##........#..#.#.#...#.#....##.......#',
    '####....#.#..#.##..#....#.#..#...##..#....###.#.#....#.#.##......##.#.#......#....#.....#.###.#.',
    '.#.....#.#....#........##..##.....##........##.......##...#........#....#...##.......##.#....#..',
    '##.#..#..##....#..#....#..#..#.#....#.#.#.#.##..#..#.#...#..#....#.#.#..#.#...........##........',
    '.#....#.#....#####.....####.#....##...##.#..#............##....#.........###......#...##...#.#.#',
    '#.......#.............#.....##.#..#.#..#..#...#.#...#........#..#.....#........###...#.##..#...#',
    '....##.#..##.#...#.##...#..#.#.##..#.#..###....#..#................#......#..##.##..##.#....#..#',
    '#...##....#..#.....#.#.#...........##..##.#......#...#.###.####...#....#..#.....#.......#..##..#',
    '..#..#...##...##....#..#........##.###..#........#.###.........#........#...#.......#...#.#.....',
    '.......#.#.#.##.......................#..#.......#......#.....#.#.#...#...#...#...##.....#..#..#',
    '.#....#.#...........#................##..#........#.#..#.######.........#.#..#.#.......#.....#..',
    '###..###.......#.#.#.......#.#...#....#..##..#.....#.........#.....#..#.##.#...#..#..#....#..###',
    '...............#....#....#.....#......#...#.....#................#.#..#....#..##......#.....#..#',
    '......#.###....#..#....#....#.....#.#.......####........##.##...####.....#....#....#..#..#......'
];

//$data = [
//    '...###...##...#...#..###',
//    '.#.###..##..##..####.##.',
//    '#.##..#..#...#..####...#',
//    '#####..#####...###....##',
//    '#..####...#.#.#.###.###.',
//    '..#.#..#..#.#.#.####.###',
//    '.####.###.#...###.#..#.#',
//    '.#.#.###.##.##.#..#.##..',
//    '###.#...#..#.##.######..',
//    '.#.#....#.##.#...###.##.',
//    '...#..#..#.#.##..###.###',
//    '##..##.#...#...#.#.#.#..',
//    '#.####....##..########.#',
//    '###.#.#...#.######.#..##',
//    '#.####..#.####.#.#.###..',
//    '#..#.##..#..###.#.##....',
//    '.####...#..#.....#......',
//    '....#..#...##..#.#.###..',
//    '...########.#....#####.#',
//    '##.#....#.##.####...#.##',
//    '###.#####...#.#####.#..#',
//    '##.##.###.#.#..######...',
//    '###....#.#....#..#......',
//    '.#.#..#.##...#.##..#####'
//];
var_dump(count($data), strlen($data[0]));
$data = rotateTile($data, 1);

$offsets = [
    [18],
    [0,5,6,11,12,17,18,19],
    [1,4,7,10,13,16]
];
$monsterSize = 15;
$numWaves = strlen(str_replace('.', '', implode('', $data)));
//echo $numWaves . "\n";
//echo $numWaves - (15 * 19)."\n";die;
$monsterCount = 0;

while ($monsterCount === 0) {

    for ($i = 0; $i < 4; $i++) {
        echo "Rotating $i\n";
        $data = rotateTile($data, $i);
        $monsterCount = findMonsters($data, $offsets);
        if ($monsterCount > 0) {
            break 2;
        }
    }
    echo "Reversing\n";
    $data = array_reverse($data);
}

echo "Found $monsterCount monsters\n";
echo "Sea roughness: " . ($numWaves - ($monsterCount * $monsterSize)) . "\n";

function findMonsters($data, $monster) {
    $monsterCount = 0;
    $dataSize = count($data);
    for ($y = 0; $y < $dataSize - 2; $y++) {
        for ($x = 0; $x < $dataSize - 19; $x++) {
            $found = true;
            foreach ($monster as $offsetY => $xOffsets) {
                foreach ($xOffsets as $offsetX) {
                    if (substr($data[$y + $offsetY], $x + $offsetX, 1) !== '#') {
                        $found = false;
                        break 2;
                    }
                }
            }




            if ($found) {
                foreach ($monster as $offsetY => $xOffsets) {
                    foreach ($xOffsets as $offsetX) {
                        $data[$y + $offsetY] = substr_replace($data[$y + $offsetY], 'O', $x + $offsetX, 1);
                    }
                }

                $monsterCount++;
                echo "Found at ($x, $y)!!\n";
            }
        }
    }

    print_r($data);
    return $monsterCount;
}

function rotateTile($tile, $rotations) {
    $copyTile = [];
    $size = count($tile);
    foreach ($tile as $i => $row) {
        $copyTile[$i] = str_split($row);
    }

    $tile = $copyTile;
    while ($rotations > 0) {
        foreach ($tile as $y => $row) {
            foreach ($row as $x => $value) {
                $copyTile[abs($size - $x - 1)][$y] = $value;
            }
        }
        $tile = $copyTile;
        $rotations--;
    }

    $copyTile = [];
    foreach($tile as $y => $row) {
        $copyTile[$y] = implode('', $row);
    }

    return $copyTile;
}